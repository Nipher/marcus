!function(window){"use strict";function getViewportH(){var client=docElem.clientHeight,inner=window.innerHeight;return inner>client?inner:client}function scrollY(){return window.pageYOffset||docElem.scrollTop}function getOffset(el){var offsetTop=0,offsetLeft=0;do isNaN(el.offsetTop)||(offsetTop+=el.offsetTop),isNaN(el.offsetLeft)||(offsetLeft+=el.offsetLeft);while(el=el.offsetParent);return{top:offsetTop,left:offsetLeft}}function inViewport(el,h){var elH=el.offsetHeight,scrolled=scrollY(),viewed=scrolled+getViewportH(),elTop=getOffset(el).top,elBottom=elTop+elH,h=h||0;return viewed>=elTop+elH*h&&elBottom-elH*h>=scrolled}function extend(a,b){for(var key in b)b.hasOwnProperty(key)&&(a[key]=b[key]);return a}function onScrollHandler(){this.didScroll||(this.didScroll=!0,setTimeout(function(){this._scrollPage()}.bind(this),60))}function AnimOnScroll(el,options){this.el=el,this.options=extend(this.defaults,options),this._onScrollFn=onScrollHandler.bind(this),this._init()}var docElem=window.document.documentElement;if(navigator.appVersion.indexOf("MSIE 8")>0){var _slice=Array.prototype.slice;Array.prototype.slice=function(){var result,start,end,i;if(this instanceof Array)return _slice.apply(this,arguments);for(result=[],start=arguments.length>=1?arguments[0]:0,end=arguments.length>=2?arguments[1]:this.length,i=start;end>i;i++)result.push(this[i]);return result}}AnimOnScroll.prototype={defaults:{minDuration:0,maxDuration:0,viewportFactor:0},_init:function(){this.items=Array.prototype.slice.call(document.querySelectorAll("#"+this.el.id+" > .grid-item")),this.itemsCount=this.items.length,this.itemsRenderedCount=0,this.didScroll=!1;var self=this;imagesLoaded(this.el,function(){self.msnry=new Masonry(self.el,{itemSelector:".grid-item",transitionDuration:0}),Modernizr.cssanimations&&(window.addEventListener("scroll",self._onScrollFn,!1),window.addEventListener("resize",function(){self._resizeHandler()},!1))})},_scrollPage:function(){var self=this,items=[];this.items.forEach(function(el,i){var img,imgSrc;classie.has(el,"shown")||classie.has(el,"animate")||!inViewport(el,self.options.viewportFactor)?items.push(el):(img=el.querySelector("img"),classie.has(img,"lazy-load")&&(imgSrc=img.getAttribute("data-img-src"),img.src=imgSrc),imagesLoaded(el,function(){var perspY=scrollY()+getViewportH()/2;if(self.el.style.WebkitPerspectiveOrigin="50% "+perspY+"px",self.el.style.MozPerspectiveOrigin="50% "+perspY+"px",self.el.style.perspectiveOrigin="50% "+perspY+"px",self._checkTotalRendered(),self.options.minDuration&&self.options.maxDuration){var randDuration=Math.random()*(self.options.maxDuration-self.options.minDuration)+self.options.minDuration+"s";el.style.WebkitAnimationDuration=randDuration,el.style.MozAnimationDuration=randDuration,el.style.animationDuration=randDuration}classie.add(el,"animate")}))}),this.didScroll=!1,this.items=items},_resizeHandler:function(){function delayed(){self._scrollPage(),self.resizeTimeout=null}var self=this;this.resizeTimeout&&clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(delayed,1e3)},_checkTotalRendered:function(){++this.itemsRenderedCount,this.itemsRenderedCount===this.itemsCount&&window.removeEventListener("scroll",this._onScrollFn)}},window.AnimOnScroll=AnimOnScroll}(window);